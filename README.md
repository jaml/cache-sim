# Cache Simulator

This is a simple cache simulator that was written for a Computer Architecture assignment. It can simulate a few different types and layouts of caches. It got a pretty good mark but there might be mistakes.

## Usage

`python trace.py TRACEFILE`

There are a number of example trace files in the `tracefiles/` directory. Trace files can be generated using the `gen_tracefile.py` script. To use that script you need to specify some details about the trace you would like to generate:

`python gen_tracefile.py BLOCK-COUNT WORD-SIZE CACHE LOOP-SIZE`

This will generate two trace files for a fused and unfused loop of the form:

``` c
for (i=0; i<N; i++)
  for (j=0; j<N; j++)
    a[i][j] = 1/b[i][j] * c[i][j];
    
for (i=0; i<N; i++)
  for (j=0; j<N; j++)
    d[i][j] = a[i][j] + c[i][j];
```

``` c
for (i=0; i<N; i++)
  for (j=0; j<N; j++) {
    a[i][j] = 1/b[i][j] * c[i][j];
    d[i][j] = a[i][j] + c[i][j];
  }
```

### Trace File Format

The first part of the trace describes the structure of the cache. This description consists of a sequence of lines, each starting with an integer, optionally followed by some comment text which describes the cache parameter being set (the text is just there for the reader’s convenience and should be ignored by the simulator). The lines are as follows:

1. the first line describes the number of blocks in the cache
2. the second line describes the number of words in a cache block
3. the third line describes the set associativity (i.e. the number of blocks per set)

The second part of the trace contains the sequence of memory accesses to be simulated, one per line, together with commands which control the output generated by the simulator:

1. a memory access line consists of either “l” or “s” (indicating load or store respectively) followed by a space and then an integer indicating the memory address to be accessed.

NB. We do not specify the actual data value being written, nor the register being used. Thus, your simulator cannot keep track of real data. All that matters in calculating hit rate is the sequence of addresses used.

2. an output control command is one of:

(a) “v”, indicating that full line-by-line explanation should be switched on (if it is currently off) or off (if it is currently on). The default is that it is off.

(b) “p” indicating that the complete content of the cache should be output in some suitable format (see below)

(c) “h” indicating that the hit-rate achieved so far should be output
For example, the following trace file indicates that the simulated cache has 8 words per block, and 16 blocks organised in a direct mapping (otherwise known as “1-way associative”). There is a sequence of six accesses of which the first three must be explained line by line in the output. The cache contents are printed after the fifth access and the hit rate is printed at the end.

#### Cache Types

* 1 - Direct Mapped Cache
* 2r - Two-way Associative Cache (Random Removal)
* 2l - Two-way Associative Cache (Least Recently Used Removal)
* 4r - Four-way Associative Cache (Random Removal)
* 4l - Four-way Associative Cache (Least Recently Used Removal)

#### Example

```
16          (blocks in total)
8           (block size)
1           (1 way associative, in other words, direct mapped)
v           (switch on line by line explanation)
l 17
l 29
s 17
v           (switch off line by line explanation)
l 25
l 35
p           (print out the cache contents)
s 29
h
```